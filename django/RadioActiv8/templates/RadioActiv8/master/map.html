{% extends "RadioActiv8/master/heading.html" %}
{% load bootstrap4 %}
{% load static %}
{% block bootstrap4_title %}
    RadioActiv8 - Map
{% endblock bootstrap4_title %}
{% block bootstrap4_extra_head %}
    {{ block.super }}
    <link rel="stylesheet"
          href="{% static 'RadioActiv8/css/ol-6.10.0.css' %}"
          type="text/css">
    <script src="{% static 'RadioActiv8/js/ol-6.10.0.js' %}"></script>
    <meta http-equiv="refresh" content="5" />
{% endblock bootstrap4_extra_head %}
{% block bootstrap4_content %}
    <div style="background: var(--dark);">
        <main style="background: var(--dark);color: var(--warning);">
            <!-- Start: 2 Rows 1+3 Columns -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-3 col-md-2 col-lg-2 col-xl-2 text-monospace"
                         data-toggle="tooltip"
                         data-bss-tooltip=""
                         style="color: var(--light);
                                font-size: 10pt;
                                padding-right: 0px;
                                padding-left: 5px">
                        <div style="padding-top: 5px;">
                            <a style="display: none"
                               class="btn btn-outline-primary shake animated"
                               data-toggle="collapse"
                               aria-expanded="true"
                               aria-controls="collapse-1"
                               href="#collapse-1"
                               role="button">MAP DATA</a>
                            <div class="collapse show" id="collapse-1">
                                <!-- Start: GPS Data -->
                                <div class="form-group" style="font-size: inherit;">
                                    <label style="font-size: inherit;">GPS Data</label>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-3"
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-3" style="font-size: inherit">
                                            Scout GPS <span class="badge badge-pill badge-success" style="font-size: inherit;">8</span>
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-4"
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-4" style="font-size: inherit">Scout GPS Paths</label>
                                    </div>
                                </div>
                                <!-- End: GPS Data -->
                                <!-- Start: Dimensions -->
                                <div class="form-group" style="font-size: inherit;">
                                    <label style="font-size: inherit;">Dimensions</label>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-5"
                                               checked=""
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-5" style="font-size: inherit">Normal Space</label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-6"
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-6" style="font-size: inherit">Alien Dimension</label>
                                    </div>
                                </div>
                                <!-- End: Dimensions -->
                                <!-- Start: RadioActiv8 Radios -->
                                <div class="form-group" style="font-size: inherit;">
                                    <label style="font-size: inherit;">RadioActiv8 Radios</label>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-7"
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-7" style="font-size: inherit">All Radios</label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-8"
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-8" style="font-size: inherit">
                                            Zone&nbsp;
                                            <i class="fas fa-digital-tachograph bg-danger"
                                               style="font-size: inherit"></i>
                                            &nbsp;Red
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-9"
                                               style="font-size: inherit">
                                        <label class="form-check-label" for="formCheck-9" style="font-size: inherit">
                                            Zone&nbsp;
                                            <i class="fas fa-digital-tachograph bg-success"
                                               style="font-size: inherit"></i>
                                            &nbsp;Green
                                            <span class="badge badge-primary" style="font-size: inherit;"></span>
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-10"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-10"
                                               style="font-size: inherit">
                                            Zone&nbsp;
                                            <i class="fas fa-digital-tachograph bg-primary"
                                               style="font-size: inherit"></i>
                                            &nbsp;Blue&nbsp;
                                            <span class="badge badge-success" style="font-size: inherit;"></span>
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-11"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-11"
                                               style="font-size: inherit">
                                            Zone&nbsp;
                                            <i class="fas fa-digital-tachograph bg-warning"
                                               style="font-size: inherit"></i>
                                            &nbsp;Yellow
                                            <span class="badge badge-warning" style="font-size: inherit;"></span>
                                        </label>
                                    </div>
                                </div>
                                <!-- End: RadioActiv8 Radios -->
                                <!-- Start: RadioActiv8 Bases -->
                                <div class="form-group" style="font-size: inherit;">
                                    <label style="font-size: inherit;">RadioActiv8 Bases</label>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-12"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-12"
                                               style="font-size: inherit">All Bases</label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-13"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-13"
                                               style="font-size: inherit">
                                            Active Bases&nbsp;
                                            <i class="fa fa-star bg-warning" style="font-size: inherit;"></i>
                                            &nbsp;
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-14"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-14"
                                               style="font-size: inherit">
                                            Passive Bases&nbsp;
                                            <i class="fa fa-snapchat-ghost bg-primary" style="font-size: inherit;"></i>
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-15"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-15"
                                               style="font-size: inherit">
                                            Empty Bases&nbsp;
                                            <i class="fa fa-star-half-empty bg-success" style="font-size: inherit;"></i>
                                        </label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-16"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-16"
                                               style="font-size: inherit">
                                            Attended Bases&nbsp;
                                            <i class="fa fa-exclamation-triangle bg-danger"
                                               style="font-size: inherit"></i>
                                        </label>
                                    </div>
                                </div>
                                <!-- End: RadioActiv8 Bases -->
                                <!-- Start: VicJam Site -->
                                <div class="form-group" style="font-size: inherit;">
                                    <label style="font-size: inherit;">VicJam Site</label>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-17"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-17"
                                               style="font-size: inherit">Site Labels</label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-18"
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-18"
                                               style="font-size: inherit">Site Models</label>
                                    </div>
                                    <div class="form-check" style="font-size: inherit;">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               id="formCheck-19"
                                               checked=""
                                               style="font-size: inherit">
                                        <label class="form-check-label"
                                               for="formCheck-19"
                                               style="font-size: inherit">Elmore Site</label>
                                    </div>
                                </div>
                                <!-- End: VicJam Site -->
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-8 col-lg-8 col-xl-8">
                        <div style="border: 0; width: 100%; height: 100%" id="map" class="map"></div>
                        <!--iframe style="border: 0; width: 100%; height: 100%" allowfullscreen
            src="//umap.openstreetmap.fr/en/map/vicjam-2021_613067?scaleControl=false&miniMap=false&scrollWheelZoom=false&zoomControl=true&allowEdit=false&moreControl=true&searchControl=null&tilelayersControl=null&embedControl=null&datalayersControl=true&onLoadPanel=undefined&captionBar=false#17/-36.49192/144.64030">
          </iframe -->
                    </div>
                    <div class="col-sm-3 col-md-2 col-lg-2 col-xl-2"
                         style="font-size: 10pt;
                                padding-top: 5px;
                                padding-right: 0px;
                                padding-left: 0px">
                        <div>
                            <div class="collapse show" id="collapse-2">
                                <div class="form-group">
                                    <!-- Start: Sort by "Longest Time since used" -->
                                    <h1 class="text-monospace" style="font-size: 12pt; color: var(--white)">AVAILABLE BASES:</h1>
                                    <!-- End: Sort by "Longest Time since used" -->
                                    <ul class="list-unstyled text-monospace">
                                        {% if available_bases %}
                                            {% for available_base in available_bases %}
                                                <li>
                                                    <a class="text-success" href="#">{{ available_base }} ({{ available_base.get_patrols_count }}/
                                                        {% if available_base.max_patrols == None %}
                                                            ∞
                                                        {% else %}
                                                            {{ available_base.max_patrols }}
                                                        {% endif %}
                                                    )</a>
                                                </li>
                                            {% endfor %}
                                        {% else %}
                                            <li>NO AVAILABLE BASES!!!</li>
                                        {% endif %}
                                    </ul>
                                </div>
                                <div class="form-group">
                                    <h1 class="text-monospace" style="font-size: 12pt; color: var(--white)">FULL BASES:</h1>
                                    <ul class="list-unstyled text-monospace text-light">
                                        {% if full_bases %}
                                            {% for full_base in full_bases %}
                                                <li>
                                                    <a class="text-nowrap text-danger" href="#">{{ full_base.name }}</a>:
                                                    <br />
                                                    {% for patrol in full_base.get_patrols %}
                                                        <a class="text-warning" href="#">{{ patrol.name }}</a>
                                                        {% if not forloop.last %},{% endif %}
                                                    {% endfor %}
                                                </li>
                                            {% endfor %}
                                        {% else %}
                                            <li>No Full Bases 😀</li>
                                        {% endif %}
                                    </ul>
                                </div>
                                <div class="form-group">
                                    <!-- Start: sort by "Last Updated" -->
                                    <h1 class="text-monospace" style="font-size: 12pt; color: var(--white)">Patrol Locations:</h1>
                                    <!-- End: sort by "Last Updated" -->
                                    <ul class="list-unstyled text-monospace text-light">
                                        {% if busy_patrols %}
                                            {% for busy_patrol in busy_patrols %}
                                                <li>
                                                    <a class="text-danger" href="#">{{ busy_patrol.name }}</a> @ <a class="text-warning" href="#">{{ busy_patrol.current_base.name }}</a>
                                                </li>
                                            {% endfor %}
                                        {% else %}
                                            <li>NO PATROLS LOGGED!!!</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End: 2 Rows 1+3 Columns -->
        </main>
    </div>
    <script type="text/javascript">
  var bases_geojson = {{bases_geojson|safe}};
  //console.log(bases_geojson);

  var basesSource = new ol.source.Vector({
    features: (new ol.format.GeoJSON()).readFeatures(bases_geojson)
  });

  var CircleStyle = ol.style.Circle;
  var Stroke = ol.style.Stroke;
  var Style = ol.style.Style;
  var Fill = ol.style.Fill;
  var Text = ol.style.Text;
  var VectorSource = ol.source.Vector;
  var GeoJSON = ol.format.GeoJSON;
  var Feature = ol.Feature;
  var Circle = ol.geom.Circle;
  var VectorLayer = ol.layer.Vector;

  const image = new CircleStyle({
    radius: 5,
    fill: null,
    stroke: new Stroke({color: 'red', width: 1}),
  });

const styleCache = {};
function styleFunction (feature) {
    var name = feature.getProperties().pk;
    let style = styleCache[name];
    if (!style) {
      style = new Style({
        image: new CircleStyle({
          radius: 10,
          stroke: new Stroke({
            color: '#fff',
          }),
          fill: new Fill({
            color: '#3399CC',
          }),
        }),
        text: new Text({
          text: name,
          fill: new Fill({
            color: '#fff',
          }),
        }),
      });
      styleCache[name] = style;
    }
    return style;
  };

  const styles = {
    'Point': new Style({
      image: image,
    })
  };

  /*
  function styleFunction (feature) {
    return styles[feature.getGeometry().getType()];
  };
  */

  var geojsonObject = {{bases_geojson|safe}};

  const vectorSource = new VectorSource({
    features: new GeoJSON().readFeatures(geojsonObject, {
      dataProjection: 'EPSG:4326',
      featureProjection:'EPSG:3857' }),
  });

  const vectorLayer = new VectorLayer({
    source: vectorSource,
    style: styleFunction,
  });



  // ------------
  var map = new ol.Map({
    target: 'map',
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      }),
      vectorLayer
    ],
    view: new ol.View({
      center: ol.proj.fromLonLat([144.63678, -36.492]),
      zoom: 17.5
    })
  });
    </script>
{% endblock bootstrap4_content %}
